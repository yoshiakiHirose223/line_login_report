# 終業報告　2021/09/15
## 取り組んだ作業
- PKCEの実装に間違いがないかドキュメント読む
- IDトークンの取得後、IDトークンを検証し入手した`aud`を用いて新規ユーザー登録
  - `users`テーブル作成
  - `todos`テーブルに`user_id`カラム追加
  - テーブル操作時に`user_id`を条件に追加


## 学んだこと・気づいたこと
- PKCEのエラー修正完了
  - `hash()`関数で暗号化するときに第３引数に`true`を指定して生のバイナリデータを返してもらっていないことが原因だった。
- `require_once`でファイルを読み込んでいるだけだと思ったら、そこで実行されている関数についてはもう一度実行されてしまうことに気づいた。読み込むべき場所と処理を実行してほしくない物などについて、注意して実装を進めていく必要があった。

## 次回予定
- ログイン状態の保持の実装
- ログアウトの実装
- ユーザーに許可されなかった場合、IDトークンの有効期限切れなどのエラーに対処
- メンテナンスなどを全く考慮せずに実装しているので、読みやすくメンテナンスしやすいようにコードを書いていく

##　質問
### PKCEの実装について
エラーが出ていた原因は恐らくLINE側の暗号化の方法と、私が実装した暗号化の方法の不一致が原因だと思われます。<br>
LINE ログインのドキュメントでは、`SHA256`に暗号化後、Base64URL形式に変換と書かれていました。<br>
私もこの通り行ったと思っていたのですが、`hash('sha256', $data)`ではダメだったみたいで、`hash('sha256', $data, true)`にすべきだったようです。<br>
そこで質問なのですが、単に`SHA256`に暗号化と言われた場合には`hash()`の第３引数に`true`を指定し生のバイナリデータを返すようにしてもらうのが一般的なのでしょうか？<br>
(指定なしの場合にはメッセージダイジェストの計算結果を小文字の16進数に変換し、返してくれるそうです。)